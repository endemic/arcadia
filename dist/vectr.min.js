/*! vectr 2013-11-12 */
void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame);var Vectr=window.Vectr||{};Vectr.Game=function(a,b,c,d){var e,f;if(a=parseInt(a,10)||320,b=parseInt(b,10)||480,"function"!=typeof c)throw"Please provide a valid Scene object.";for(void 0===d&&(d=!0),Vectr.WIDTH=a,Vectr.HEIGHT=b,Vectr.SCALE=1,Vectr.OFFSET={x:0,y:0},Vectr.instance=this,this.element=document.createElement("div"),this.element.setAttribute("id","vectr"),this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.context=this.canvas.getContext("2d"),this.scanlines=document.createElement("canvas"),this.scanlines.setAttribute("width",a),this.scanlines.setAttribute("height",b),this.scanlines.setAttribute("style","position: absolute; left: 0; top: 0; z-index: 1;"),f=this.scanlines.getContext("2d"),f.lineWidth=.5,f.beginPath(),e=0;b>e;e+=3)f.moveTo(0,e),f.lineTo(a,e);f.closePath(),f.strokeStyle="rgba(0, 0, 0, 0.75)",f.stroke(),this.element.appendChild(this.canvas),this.element.appendChild(this.scanlines),document.body.appendChild(this.element),this.onResize=this.onResize.bind(this),this.onPointStart=this.onPointStart.bind(this),this.onPointMove=this.onPointMove.bind(this),this.onPointEnd=this.onPointEnd.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.element.addEventListener("mousedown",this.onPointStart,!1),this.element.addEventListener("mouseup",this.onPointEnd,!1),this.element.addEventListener("touchstart",this.onPointStart,!1),this.element.addEventListener("touchmove",this.onPointMove,!1),this.element.addEventListener("touchend",this.onPointEnd,!1),document.addEventListener("touchmove",function(a){a.preventDefault()}),d===!0&&(this.onResize(),window.addEventListener("resize",this.onResize,!1)),void 0!==window.cordova&&(document.addEventListener("pause",this.pause,!1),document.addEventListener("resume",this.resume,!1)),this.input={left:!1,up:!1,right:!1,down:!1,w:!1,a:!1,s:!1,d:!1,enter:!1,escape:!1,space:!1,control:!1,z:!1,x:!1},this.points=[],this.active=new c,this.start()},Vectr.Game.prototype.pause=function(){this.pausedMusic=this.currentMusic,Vectr.stopMusic(),"function"==typeof this.active.pause&&this.active.pause()},Vectr.Game.prototype.resume=function(){Vectr.playMusic(this.pausedMusic),"function"==typeof this.active.resume&&this.active.resume()},Vectr.Game.prototype.onPointStart=function(a){Vectr.getPoints(a),-1!==a.type.indexOf("mouse")&&this.element.addEventListener("mousemove",this.onPointMove,!1),"function"==typeof this.active.onPointStart&&this.active.onPointStart(this.points)},Vectr.Game.prototype.onPointMove=function(a){Vectr.getPoints(a),"function"==typeof this.active.onPointMove&&this.active.onPointMove(this.points)},Vectr.Game.prototype.onPointEnd=function(a){Vectr.getPoints(a),-1!==a.type.indexOf("mouse")&&this.element.removeEventListener("mousemove",this.onPointMove,!1),"function"==typeof this.active.onPointEnd&&this.active.onPointEnd(this.points)},Vectr.Game.prototype.onKeyDown=function(a){var b;switch(a.keyCode){case 37:b="left";break;case 38:b="up";break;case 39:b="right";break;case 40:b="down";break;case 87:b="w";break;case 65:b="a";break;case 83:b="s";break;case 68:b="d";break;case 13:b="enter";break;case 27:b="escape";break;case 32:b="space";break;case 17:b="control";break;case 90:b="z";break;case 88:b="x"}this.input[b]!==!0&&(this.input[b]=!0,"function"==typeof this.active.onKeyDown&&this.active.onKeyDown(b))},Vectr.Game.prototype.onKeyUp=function(a){var b;switch(a.keyCode){case 37:b="left";break;case 38:b="up";break;case 39:b="right";break;case 40:b="down";break;case 87:b="w";break;case 65:b="a";break;case 83:b="s";break;case 68:b="d";break;case 13:b="enter";break;case 27:b="escape";break;case 32:b="space";break;case 17:b="control";break;case 90:b="z";break;case 88:b="x"}this.input[b]=!1,"function"==typeof this.active.onKeyUp&&this.active.onKeyUp(b)},Vectr.Game.prototype.start=function(){var a,b,c;b=this,a=void 0!==window.performance?window.performance.now():Date.now(),c=function(d){var e=d-a;a=d,b.update(e/1e3),b.updateId=window.requestAnimationFrame(c)},this.updateId=window.requestAnimationFrame(c)},Vectr.Game.prototype.stop=function(){window.cancelAnimationFrame(this.updateId)},Vectr.Game.prototype.update=function(a){this.active.draw(this.context),this.active.update(a)},Vectr.Game.prototype.onResize=function(){var a,b,c,d,e;a=window.innerWidth,b=window.innerHeight,a>b?(d="landscape",c=Vectr.WIDTH/Vectr.HEIGHT):(d="portrait",c=Vectr.HEIGHT/Vectr.WIDTH),"landscape"===d?a/c>b?(a=b*c,e="0 "+(window.innerWidth-a)/2+"px"):b>a/c&&(b=a/c,e=(window.innerHeight-b)/2+"px 0"):"portrait"===d&&(b/c>a?(b=a*c,e=(window.innerHeight-b)/2+"px 0"):a>b/c&&(a=b/c,e="0 "+(window.innerWidth-a)/2+"px")),Vectr.SCALE=b/Vectr.HEIGHT,Vectr.OFFSET.x=(window.innerWidth-a)/2,Vectr.OFFSET.y=(window.innerHeight-b)/2,this.element.setAttribute("style","position: relative; width: "+a+"px; height: "+b+"px; margin: "+e),this.canvas.setAttribute("style","position: absolute; left: 0; top: 0; -webkit-transform: scale("+Vectr.SCALE+"); -webkit-transform-origin: 0 0; transform: scale("+Vectr.SCALE+"); transform-origin: 0 0;"),this.scanlines.setAttribute("style","position: absolute; left: 0; top: 0; z-index: 1; -webkit-transform: scale("+Vectr.SCALE+"); -webkit-transform-origin: 0 0; transform: scale("+Vectr.SCALE+"); transform-origin: 0 0;")},Vectr.env=function(){var a,b,c,d,e;return a=navigator.userAgent.toLowerCase(),b=a.match(/android/i)&&a.match(/android/i).length>0||!1,c=(a.match(/ip(hone|od|ad)/i)&&a.match(/ip(hone|od|ad)/i).length)>0||!1,d=a.match(/firefox/i)&&a.match(/firefox/i).length>0||!1,e=a.match(/mobile/i)&&a.match(/mobile/i).length>0||!1||b,{android:b,ios:c,firefox:d,mobile:e,desktop:!e,cordova:void 0!==window.cordova}}(),Vectr.changeScene=function(a){if("function"!=typeof a)throw"Trying to change to an invalid scene.";Vectr.instance.active.destroy(),Vectr.instance.active=new a},Vectr.getPoints=function(a){var b,c=0;if(Vectr.instance.points.length=0,-1!==a.type.indexOf("mouse"))Vectr.instance.points.push({x:(a.pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(a.pageY-Vectr.OFFSET.y)/Vectr.SCALE});else for(b=a.touches.length;b>c;)Vectr.instance.points.push({x:(a.touches[c].pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(a.touches[c].pageY-Vectr.OFFSET.y)/Vectr.SCALE}),c+=1},Vectr.music={},Vectr.sounds={},Vectr.currentMusic=null,Vectr.playSfx=function(a){"false"!==localStorage.getItem("playSfx")&&void 0!==Vectr.sounds[a]&&"function"==typeof Vectr.sounds[a].play&&Vectr.sounds[a].play()},Vectr.playMusic=function(a){"false"!==localStorage.getItem("playMusic")&&Vectr.currentMusic!==a&&(void 0===a&&null!==Vectr.currentMusic&&(a=Vectr.currentMusic),null!==Vectr.currentMusic&&Vectr.music[Vectr.currentMusic].stop(),Vectr.music[a].play(),Vectr.currentMusic=a)},Vectr.stopMusic=function(){null!==Vectr.currentMusic&&(Vectr.music[Vectr.currentMusic].stop(),Vectr.currentMusic=null)};var Vectr=window.Vectr||{};Vectr.GameObject=function(a,b){this.position={x:a||0,y:b||0},this.active=!0,this.fixed=!1,this.scale=1,this.rotation=0,this.glow=0,this.colors={red:255,green:255,blue:255,alpha:1},this.children=[],this.i=0},Vectr.GameObject.prototype.draw=function(a,b,c){if(this.active!==!1)for(b=b||0,c=c||0,this.i=this.children.length;this.i--;)this.children[this.i].draw(a,b,c)},Vectr.GameObject.prototype.update=function(a){if(this.active!==!1)for(this.i=this.children.length;this.i--;)this.children[this.i].update(a)},Vectr.GameObject.prototype.add=function(a){this.children.push(a)},Vectr.GameObject.prototype.remove=function(a){this.i=this.children.indexOf(a),-1!==this.i&&this.children.splice(this.i,1)},Vectr.GameObject.prototype.destroy=function(){for(this.i=this.children.length;this.i--;)"function"==typeof this.children[this.i].destroy&&this.children[this.i].destroy()},Object.defineProperty(Vectr.GameObject.prototype,"color",{get:function(){return"rgba("+this.colors.red+", "+this.colors.green+", "+this.colors.blue+", "+this.colors.alpha+")"},set:function(a){if("string"==typeof a){var b=a.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/);5===b.length&&(this.colors.red=parseInt(b[1],10),this.colors.green=parseInt(b[2],10),this.colors.blue=parseInt(b[3],10),this.colors.alpha=parseFloat(b[4],10))}}});var Vectr=window.Vectr||{};Vectr.Button=function(a,b,c){Vectr.GameObject.call(this,a,b),this.label=new Vectr.Label(a,b,c),this.add(this.label),this.backgroundColors={red:255,green:255,blue:255,alpha:1},this.height=parseInt(this.label.fonts.size,10),this.solid=!0,this.padding=10,this.fixed=!0,this.onPointEnd=this.onPointEnd.bind(this),Vectr.instance.element.addEventListener("mouseup",this.onPointEnd,!1),Vectr.instance.element.addEventListener("touchend",this.onPointEnd,!1)},Vectr.Button.prototype=new Vectr.GameObject,Vectr.Button.prototype.draw=function(a,b,c){this.active!==!1&&(Vectr.GameObject.prototype.draw.call(this,a,this.position.x+b,this.position.y+c),this.fixed===!0&&(b=c=0),this.width=this.label.width(a),a.save(),a.translate(this.position.x+b,this.position.y+c),this.glow>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=this.glow,a.shadowColor=this.color),this.solid===!0?(a.fillStyle=this.backgroundColor,a.fillRect(-this.width/2-this.padding/2,-this.height/2-this.padding/2,this.width+this.padding,this.height+this.padding)):(a.strokeStyle=this.backgroundColor,a.strokeRect(-this.width/2-this.padding/2,-this.height/2-this.padding/2,this.width+this.padding,this.height+this.padding)),a.restore())},Vectr.Button.prototype.update=function(a){this.active!==!1&&Vectr.GameObject.prototype.update.call(this,a)},Vectr.Button.prototype.onPointEnd=function(a){if(this.active!==!1&&"function"==typeof this.onUp){Vectr.getPoints(a);for(var b=Vectr.instance.points.length;b--;)if(this.containsPoint(Vectr.instance.points[b].x,Vectr.instance.points[b].y)){this.onUp();break}}},Vectr.Button.prototype.containsPoint=function(a,b){return a<this.position.x+this.width/2+this.padding/2&&a>this.position.x-this.width/2-this.padding/2&&b<this.position.y+this.height/2+this.padding/2&&b>this.position.y-this.height/2-this.padding/2},Vectr.Button.prototype.destroy=function(){Vectr.instance.element.removeEventListener("mouseup",this.onPointEnd,!1),Vectr.instance.element.removeEventListener("touchend",this.onPointEnd,!1)},Object.defineProperty(Vectr.Button.prototype,"backgroundColor",{get:function(){return"rgba("+this.backgroundColors.red+", "+this.backgroundColors.green+", "+this.backgroundColors.blue+", "+this.backgroundColors.alpha+")"},set:function(a){if("string"==typeof a){var b=a.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/);5===b.length&&(this.backgroundColors.red=parseInt(b[1],10),this.backgroundColors.green=parseInt(b[2],10),this.backgroundColors.blue=parseInt(b[3],10),this.backgroundColors.alpha=parseFloat(b[4],10))}}}),Object.defineProperty(Vectr.Button.prototype,"font",{get:function(){return this.label.font},set:function(a){"string"==typeof a&&(this.label.font=a)}});var Vectr=window.Vectr||{};Vectr.Emitter=function(a,b,c){Vectr.GameObject.apply(this,arguments);var d;for(this.particles=new Vectr.Pool,this.duration=1,this.fade=!1,this.speed=200,c=c||25;c--;)d=new Vectr.Shape(0,0,a||"square",b||5),d.active=!1,d.solid=!0,this.particles.add(d)},Vectr.Emitter.prototype=new Vectr.GameObject,Vectr.Emitter.prototype.start=function(a,b){this.particles.activateAll(),this.active=!0;var c,d=this.particles.length;for(this.position.x=a,this.position.y=b;d--;)this.particles.at(d).position.x=a,this.particles.at(d).position.y=b,c=2*Math.random()*Math.PI,this.particles.at(d).velocity.x=Math.cos(c),this.particles.at(d).velocity.y=Math.sin(c),this.particles.at(d).speed=Math.random()*this.speed,this.particles.at(d).color=this.color;this.timer=0},Vectr.Emitter.prototype.draw=function(a,b,c){this.active!==!1&&(b=b||0,c=c||0,this.particles.draw(a,b,c))},Vectr.Emitter.prototype.update=function(a){if(this.active!==!1){var b=this.particles.length;for(0===b&&(this.active=!1),this.particles.update(a),this.timer+=a;b--;)this.fade&&(this.particles.at(b).colors.alpha-=a/this.duration),this.timer>=this.duration&&this.particles.deactivate(b)}};var Vectr=window.Vectr||{};Vectr.Label=function(a,b,c){Vectr.GameObject.apply(this,arguments),this.text=c,this.fixed=!0,this.fonts={size:"10px",family:"monospace"},this.alignment="center",this.solid=!0},Vectr.Label.prototype=new Vectr.GameObject,Vectr.Label.prototype.draw=function(a,b,c){this.active!==!1&&(Vectr.GameObject.prototype.draw.call(this,a,this.position.x+b,this.position.y+c),this.fixed===!0&&(b=c=0),a.save(),a.font=this.font,a.textAlign=this.alignment,a.translate(this.position.x+b,this.position.y+parseInt(this.fonts.size,10)/3+c),1!==this.scale&&a.scale(this.scale,this.scale),0!==this.rotation&&this.rotation!==2*Math.PI&&a.rotate(this.rotation),this.glow>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=this.glow,a.shadowColor=this.color),this.solid===!0?(a.fillStyle=this.color,a.fillText(this.text,0,0,Vectr.WIDTH)):(a.strokeStyle=this.color,a.strokeText(this.text,0,0,Vectr.WIDTH)),a.restore())},Vectr.Label.prototype.update=function(a){this.active!==!1&&Vectr.GameObject.prototype.update.call(this,a)},Vectr.Label.prototype.width=function(a){var b;return a.save(),a.font=this.fonts.size+" "+this.fonts.family,a.textAlign=this.alignment,b=a.measureText(this.text),a.restore(),b.width},Object.defineProperty(Vectr.Label.prototype,"font",{get:function(){return this.fonts.size+" "+this.fonts.family},set:function(a){if("string"==typeof a){var b=a.split(" ");2===b.length&&(this.fonts.size=b[0],this.fonts.family=b[1])}}});var Vectr=window.Vectr||{};Vectr.Pool=function(){this.length=0,this.children=[],this.inactive=[],this.i=0},Vectr.Pool.prototype.activate=function(){return 0===this.inactive.length?null:(this.i=this.inactive.pop(),this.i.active=!0,"function"==typeof this.i.activate&&this.i.activate(),this.children.push(this.i),this.length+=1,this.i)},Vectr.Pool.prototype.activateAll=function(){for(;this.inactive.length;)this.i=this.inactive.pop(),this.i.active=!0,"function"==typeof this.i.activate&&this.i.activate(),this.children.push(this.i),this.length+=1},Vectr.Pool.prototype.deactivate=function(a){if(void 0!==this.children[a]){for(this.children[a].active=!1,this.inactive.push(this.children[a]),this.i=a;this.i<this.children.length-1;this.i+=1)this.children[this.i]=this.children[this.i+1];this.children.length-=1,this.length-=1,0===this.length&&(this.active=!1)}},Vectr.Pool.prototype.deactivateAll=function(){for(;this.children.length;)this.i=this.children.pop(),this.i.active=!1,this.inactive.push(this.i),this.length-=1},Vectr.Pool.prototype.at=function(a){return this.children[a]||null},Vectr.Pool.prototype.add=function(a){if("object"!=typeof a||void 0===a.active)throw"Can't add non-Vectr objects to a Pool.";a.active===!0?(this.children.push(a),this.length+=1):this.inactive.push(a)},Vectr.Pool.prototype.update=function(a){for(this.i=this.children.length;this.i--;)this.children[this.i].update(a),this.children[this.i].active===!1&&this.deactivate(this.i)},Vectr.Pool.prototype.draw=function(a,b,c){for(this.i=this.children.length,b=b||0,c=c||0;this.i--;)this.children[this.i].draw(a,b,c)};var Vectr=window.Vectr||{};Vectr.Scene=function(){Vectr.GameObject.apply(this,arguments),this.camera={target:null,viewport:{width:Vectr.WIDTH,height:Vectr.HEIGHT},bounds:{top:0,bottom:Vectr.HEIGHT,left:0,right:Vectr.WIDTH},position:{x:Vectr.WIDTH/2,y:Vectr.HEIGHT/2}}},Vectr.Scene.prototype=new Vectr.GameObject,Vectr.Scene.prototype.update=function(a){Vectr.GameObject.prototype.update.call(this,a),null!==this.camera.target&&(this.camera.position.x=this.camera.target.position.x,this.camera.position.y=this.camera.target.position.y,this.camera.position.x<this.camera.bounds.left+this.camera.viewport.width/2?this.camera.position.x=this.camera.bounds.left+this.camera.viewport.width/2:this.camera.position.x>this.camera.bounds.right-this.camera.viewport.width/2&&(this.camera.position.x=this.camera.bounds.right-this.camera.viewport.width/2),this.camera.position.y<this.camera.bounds.top+this.camera.viewport.height/2?this.camera.position.y=this.camera.bounds.top+this.camera.viewport.height/2:this.camera.position.y>this.camera.bounds.bottom-this.camera.viewport.height/2&&(this.camera.position.y=this.camera.bounds.bottom-this.camera.viewport.height/2))},Vectr.Scene.prototype.draw=function(a){"string"==typeof this.clearColor?(a.save(),a.fillStyle=this.clearColor,a.fillRect(0,0,a.canvas.width,a.canvas.height),a.restore()):a.clearRect(0,0,a.canvas.width,a.canvas.height),Vectr.GameObject.prototype.draw.call(this,a,this.camera.viewport.width/2-this.camera.position.x,this.camera.viewport.height/2-this.camera.position.y)},Object.defineProperty(Vectr.Scene.prototype,"target",{get:function(){return this.camera.target},set:function(a){"object"==typeof a&&void 0!==a.position&&(this.camera.target=a,this.camera.position.x=a.position.x,this.camera.position.y=a.position.y)}});var Vectr=window.Vectr||{};Vectr.Shape=function(a,b,c,d){Vectr.GameObject.call(this,a,b),this.shape=c||"square",this.size=d||10,this.lineWidth=1,this.lineJoin="round",this.speed=1,this.velocity={x:0,y:0},this.solid=!1},Vectr.Shape.prototype=new Vectr.GameObject,Vectr.Shape.prototype.draw=function(a,b,c){if(this.active!==!1){if(this.fixed===!0&&(b=c=0),Vectr.GameObject.prototype.draw.call(this,a,this.position.x+b,this.position.y+c),a.save(),a.translate(this.position.x+b,this.position.y+c),1!==this.scale&&a.scale(this.scale,this.scale),0!==this.rotation&&this.rotation!==2*Math.PI&&a.rotate(this.rotation),this.glow>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=this.glow,a.shadowColor=this.color),a.lineWidth=this.lineWidth,a.lineJoin=this.lineJoin,"function"==typeof this.path)this.path(a);else{switch(a.beginPath(),this.shape){case"triangle":a.moveTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0)),a.lineTo(this.size/2*Math.cos(120*Math.PI/180),this.size/2*Math.sin(120*Math.PI/180)),a.lineTo(this.size/2*Math.cos(240*Math.PI/180),this.size/2*Math.sin(240*Math.PI/180)),a.lineTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0));break;case"circle":a.arc(0,0,this.size/2,2*Math.PI,!1);break;case"square":a.moveTo(this.size/2,this.size/2),a.lineTo(this.size/2,-this.size/2),a.lineTo(-this.size/2,-this.size/2),a.lineTo(-this.size/2,this.size/2),a.lineTo(this.size/2,this.size/2)}a.closePath(),this.solid===!0?(a.fillStyle=this.color,a.fill()):(a.strokeStyle=this.color,a.stroke())}a.restore()}},Vectr.Shape.prototype.update=function(a){this.active!==!1&&(this.position.x+=this.velocity.x*this.speed*a,this.position.y+=this.velocity.y*this.speed*a,Vectr.GameObject.prototype.update.call(this,a))},Vectr.Shape.prototype.collidesWith=function(a){return"square"===this.shape?Math.abs(this.position.x-a.position.x)<this.size/2+a.size/2&&Math.abs(this.position.y-a.position.y)<this.size/2+a.size/2:Math.sqrt(Math.pow(a.position.x-this.position.x,2)+Math.pow(a.position.y-this.position.y,2))<this.size/2+a.size/2};