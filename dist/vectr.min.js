/*! vectr 2013-10-09 */
void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame);var Vectr={VERSION:"0.2",Game:function(a,b,c,d){var e,f;if(void 0===a&&(a=320),void 0===b&&(b=480),"function"!=typeof c)throw"Please provide a valid Scene object.";for(void 0===d&&(d=!0),Vectr.WIDTH=a,Vectr.HEIGHT=b,Vectr.SCALE=1,Vectr.OFFSET={x:0,y:0},Vectr.instance=this,this.element=document.createElement("div"),this.element.setAttribute("id","vectr"),this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.context=this.canvas.getContext("2d"),this.scanlines=document.createElement("canvas"),this.scanlines.setAttribute("width",a),this.scanlines.setAttribute("height",b),this.scanlines.setAttribute("style","position: absolute; left: 0; top: 0; z-index: 1;"),f=this.scanlines.getContext("2d"),f.lineWidth=.5,f.beginPath(),e=0;b>e;e+=3)f.moveTo(0,e),f.lineTo(a,e);f.closePath(),f.strokeStyle="rgba(0, 0, 0, 0.75)",f.stroke(),this.element.appendChild(this.canvas),this.element.appendChild(this.scanlines),document.body.appendChild(this.element),this.onResize=this.onResize.bind(this),this.onPointStart=this.onPointStart.bind(this),this.onPointMove=this.onPointMove.bind(this),this.onPointEnd=this.onPointEnd.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.element.addEventListener("mousedown",this.onPointStart,!1),this.element.addEventListener("mouseup",this.onPointEnd,!1),this.element.addEventListener("touchstart",this.onPointStart,!1),this.element.addEventListener("touchmove",this.onPointMove,!1),this.element.addEventListener("touchend",this.onPointEnd,!1),document.addEventListener("touchmove",function(a){a.preventDefault()}),d===!0&&(this.onResize(),window.addEventListener("resize",this.onResize,!1)),void 0!==window.cordova&&(document.addEventListener("pause",this.pause,!1),document.addEventListener("resume",this.resume,!1)),this.input={left:!1,up:!1,right:!1,down:!1,w:!1,a:!1,s:!1,d:!1,enter:!1,escape:!1,space:!1,control:!1,z:!1,x:!1},this.points=[],this.active=new c,this.start()}};Vectr.Game.prototype.pause=function(){this.pausedMusic=this.currentMusic,Vectr.stopMusic(),"function"==typeof this.active.pause&&this.active.pause()},Vectr.Game.prototype.resume=function(){Vectr.playMusic(this.pausedMusic),"function"==typeof this.active.resume&&this.active.resume()},Vectr.Game.prototype.onPointStart=function(a){Vectr.getPoints(a),-1!==a.type.indexOf("mouse")&&this.element.addEventListener("mousemove",this.onPointMove,!1),"function"==typeof this.active.onPointStart&&this.active.onPointStart(this.points)},Vectr.Game.prototype.onPointMove=function(a){Vectr.getPoints(a),"function"==typeof this.active.onPointMove&&this.active.onPointMove(this.points)},Vectr.Game.prototype.onPointEnd=function(a){Vectr.getPoints(a),-1!==a.type.indexOf("mouse")&&this.element.removeEventListener("mousemove",this.onPointMove,!1),"function"==typeof this.active.onPointEnd&&this.active.onPointEnd(this.points)},Vectr.Game.prototype.onKeyDown=function(a){var b;switch(a.keyCode){case 37:b="left";break;case 38:b="up";break;case 39:b="right";break;case 40:b="down";break;case 87:b="w";break;case 65:b="a";break;case 83:b="s";break;case 68:b="d";break;case 13:b="enter";break;case 27:b="escape";break;case 32:b="space";break;case 17:b="control";break;case 90:b="z";break;case 88:b="x"}this.input[b]!==!0&&(this.input[b]=!0,"function"==typeof this.active.onKeyDown&&this.active.onKeyDown(b))},Vectr.Game.prototype.onKeyUp=function(a){var b;switch(a.keyCode){case 37:b="left";break;case 38:b="up";break;case 39:b="right";break;case 40:b="down";break;case 87:b="w";break;case 65:b="a";break;case 83:b="s";break;case 68:b="d";break;case 13:b="enter";break;case 27:b="escape";break;case 32:b="space";break;case 17:b="control";break;case 90:b="z";break;case 88:b="x"}this.input[b]=!1,"function"==typeof this.active.onKeyUp&&this.active.onKeyUp(b)},Vectr.Game.prototype.start=function(){var a,b,c;b=this,a=void 0!==window.performance?window.performance.now():Date.now(),c=function(d){var e=d-a;a=d,b.update(e/1e3),b.updateId=window.requestAnimationFrame(c)},this.updateId=window.requestAnimationFrame(c)},Vectr.Game.prototype.stop=function(){window.cancelAnimationFrame(this.updateId)},Vectr.Game.prototype.update=function(a){this.active.draw(this.context),this.active.update(a)},Vectr.Game.prototype.onResize=function(){var a,b,c,d,e;a=window.innerWidth,b=window.innerHeight,a>b?(d="landscape",c=Vectr.WIDTH/Vectr.HEIGHT):(d="portrait",c=Vectr.HEIGHT/Vectr.WIDTH),"landscape"===d?a/c>b?(a=b*c,e="0 "+(window.innerWidth-a)/2+"px"):b>a/c&&(b=a/c,e=(window.innerHeight-b)/2+"px 0"):"portrait"===d&&(b/c>a?(b=a*c,e=(window.innerHeight-b)/2+"px 0"):a>b/c&&(a=b/c,e="0 "+(window.innerWidth-a)/2+"px")),Vectr.SCALE=b/Vectr.HEIGHT,Vectr.OFFSET.x=(window.innerWidth-a)/2,Vectr.OFFSET.y=(window.innerHeight-b)/2,this.element.setAttribute("style","position: relative; width: "+a+"px; height: "+b+"px; margin: "+e),this.canvas.setAttribute("style","position: absolute; left: 0; top: 0; -webkit-transform: scale("+Vectr.SCALE+"); -webkit-transform-origin: 0 0;"),this.scanlines.setAttribute("style","position: absolute; left: 0; top: 0; z-index: 1; -webkit-transform: scale("+Vectr.SCALE+"); -webkit-transform-origin: 0 0;")},Vectr.env=function(){var a,b,c,d,e;return a=navigator.userAgent.toLowerCase(),b=a.match(/android/i)&&a.match(/android/i).length>0||!1,c=(a.match(/ip(hone|od|ad)/i)&&a.match(/ip(hone|od|ad)/i).length)>0||!1,d=a.match(/firefox/i)&&a.match(/firefox/i).length>0||!1,e=a.match(/mobile/i)&&a.match(/mobile/i).length>0||!1||b,{android:b,ios:c,firefox:d,mobile:e,desktop:!e,cordova:void 0!==window.cordova}}(),Vectr.changeScene=function(a){if("function"!=typeof a)throw"Trying to change to an invalid scene.";Vectr.instance.active.destroy(),Vectr.instance.active=new a},Vectr.getPoints=function(a){var b,c=0;if(Vectr.instance.points.length=0,-1!==a.type.indexOf("mouse"))Vectr.instance.points.push({x:(a.pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(a.pageY-Vectr.OFFSET.y)/Vectr.SCALE});else for(b=a.touches.length;b>c;)Vectr.instance.points.push({x:(a.touches[c].pageX-Vectr.OFFSET.x)/Vectr.SCALE,y:(a.touches[c].pageY-Vectr.OFFSET.y)/Vectr.SCALE}),c+=1},Vectr.music={},Vectr.sounds={},Vectr.currentMusic=null,Vectr.playSfx=function(a){"false"!==localStorage.getItem("playSfx")&&void 0!==Vectr.sounds[a]&&"function"==typeof Vectr.sounds[a].play&&Vectr.sounds[a].play()},Vectr.playMusic=function(a){"false"!==localStorage.getItem("playMusic")&&Vectr.currentMusic!==a&&(void 0===a&&null!==Vectr.currentMusic&&(a=Vectr.currentMusic),null!==Vectr.currentMusic&&Vectr.music[Vectr.currentMusic].stop(),Vectr.music[a].play(),Vectr.currentMusic=a)},Vectr.stopMusic=function(){null!==Vectr.currentMusic&&(Vectr.music[Vectr.currentMusic].stop(),Vectr.currentMusic=null)},Vectr.Button=function(a,b,c,d,e,f){this.label=new Vectr.Label(a,b,c,d,e,"center"),this.position={x:a,y:b},this.backgroundColor=f||e,this.height=parseInt(d.split(" ").shift(),10),this.active=!0,this.solid=!0,this.padding=10,this.onPointEnd=this.onPointEnd.bind(this),Vectr.instance.element.addEventListener("mouseup",this.onPointEnd,!1),Vectr.instance.element.addEventListener("touchend",this.onPointEnd,!1)},Vectr.Button.prototype.draw=function(a){this.active!==!1&&(this.width=this.label.width(a),a.save(),a.translate(this.position.x,this.position.y),this.solid===!0?(a.fillStyle=this.backgroundColor,a.fillRect(-this.width/2-this.padding/2,-this.height/2-this.padding,this.width+this.padding,this.height+this.padding)):(a.strokeStyle=this.backgroundColor,a.strokeRect(-this.width/2-this.padding/2,-this.height/2-this.padding/2,this.width+this.padding,this.height+this.padding)),a.restore(),this.label.draw(a))},Vectr.Button.prototype.onPointEnd=function(a){if(this.active!==!1&&"function"==typeof this.onUp)if(Vectr.getPoints(a),-1!==a.type.indexOf("mouse"))this.containsPoint(Vectr.instance.points[0].x,Vectr.instance.points[0].y)&&this.onUp();else for(var b=Vectr.instance.points.length;b--;)if(this.containsPoint(Vectr.instance.points[b].x,Vectr.instance.points[b].y)){this.onUp();break}},Vectr.Button.prototype.containsPoint=function(a,b){return a<this.position.x+this.width/2+this.padding/2&&a>this.position.x-this.width/2-this.padding/2&&b<this.position.y+this.height/2&&b>this.position.y-this.height/2-this.padding},Vectr.Button.prototype.destroy=function(){Vectr.instance.element.removeEventListener("mouseup",this.onPointEnd,!1),Vectr.instance.element.removeEventListener("touchend",this.onPointEnd,!1)},Vectr.Button.prototype.update=function(){},Vectr.Emitter=function(a,b,c,d,e,f){var g,h;for(d=d||25,this.duration=e||1,this.fade=f||!1,this.particles=new Vectr.Pool,this.speed=200,(h=c.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/))&&(this.color={red:parseInt(h[1],10),green:parseInt(h[2],10),blue:parseInt(h[3],10)});d--;)g=new Vectr.Shape(0,0,a,b),g.active=!1,g.solid=!0,this.particles.add(g)},Vectr.Emitter.prototype.start=function(a,b){this.particles.activateAll(),this.active=!0;for(var c,d=this.particles.length;d--;)this.particles.at(d).position.x=a,this.particles.at(d).position.y=b,c=2*Math.random()*Math.PI,this.particles.at(d).velocity.x=Math.cos(c),this.particles.at(d).velocity.y=Math.sin(c),this.particles.at(d).speed=Math.random()*this.speed,this.particles.at(d).color.red=this.color.red,this.particles.at(d).color.green=this.color.green,this.particles.at(d).color.blue=this.color.blue,this.particles.at(d).color.alpha=1;this.timer=0},Vectr.Emitter.prototype.draw=function(a){for(var b=this.particles.length;b--;)this.particles.at(b).draw(a)},Vectr.Emitter.prototype.update=function(a){this.timer+=a;var b=this.particles.length;for(0===b&&(this.active=!1);b--;)this.particles.at(b).update(a),this.fade&&(this.particles.at(b).color.alpha-=a/this.duration),this.timer>=this.duration&&this.particles.deactivate(b)},Vectr.Label=function(a,b,c,d,e,f){var g;this.text=c,this.font={size:"20px",family:"monospaced"},"string"==typeof d&&(g=d.split(" "),2===g.length&&(this.font.size=g[0],this.font.family=g[1])),this.color={red:255,green:255,blue:255,alpha:1},"string"==typeof e&&(g=e.split(","),4===g.length&&(this.color.red=parseInt(g[0].replace("rgba(",""),10),this.color.green=parseInt(g[1],10),this.color.blue=parseInt(g[2],10),this.color.alpha=parseFloat(g[3].replace(")",""),10))),this.alignment="center","string"==typeof f&&(this.alignment=f),this.scale=1,this.rotation=0,this.position={x:a,y:b},this.active=!0,this.solid=!0},Vectr.Label.prototype.draw=function(a){this.active!==!1&&(a.save(),a.font=this.font.size+" "+this.font.family,a.textAlign=this.alignment,a.translate(this.position.x,this.position.y+parseInt(this.font.size,10)/3),1!==this.scale&&a.scale(this.scale,this.scale),0!==this.rotation&&360!==this.rotation&&a.rotate(this.rotation),this.solid===!0?(a.fillStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")",a.fillText(this.text,0,0,Vectr.WIDTH)):(a.strokeStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")",a.strokeText(this.text,0,0,Vectr.WIDTH)),a.restore())},Vectr.Label.prototype.update=function(){},Vectr.Label.prototype.width=function(a){var b;return a.save(),a.font=this.font.size+" "+this.font.family,a.textAlign=this.alignment,b=a.measureText(this.text),a.restore(),b.width},Vectr.Pool=function(){this.length=0,this.children=[],this.inactive=[]},Vectr.Pool.prototype.activate=function(){if(0===this.inactive.length)return null;var a=this.inactive.pop();return a.active=!0,this.children.push(a),this.length+=1,a},Vectr.Pool.prototype.activateAll=function(){for(var a;this.inactive.length;)a=this.inactive.pop(),a.active=!0,this.children.push(a),this.length+=1},Vectr.Pool.prototype.deactivate=function(a){if(void 0!==this.children[a]){this.children[a].active=!1,this.inactive.push(this.children[a]);var b,c;for(b=a,c=this.children.length-1;c>b;b+=1)this.children[b]=this.children[b+1];this.children.length=c,this.length-=1,0===this.length&&(this.active=!1)}},Vectr.Pool.prototype.deactivateAll=function(){for(var a;this.children.length;)a=this.children.pop(),a.active=!1,this.inactive.push(a),this.length-=1},Vectr.Pool.prototype.at=function(a){return this.children[a]||null},Vectr.Pool.prototype.add=function(a){"object"==typeof a&&a.active===!0?(this.children.push(a),this.length+=1):this.inactive.push(a)},Vectr.Pool.prototype.update=function(a){for(var b=this.children.length;b--;)this.children[b].update(a),this.children[b].active===!1&&this.deactivate(b)},Vectr.Pool.prototype.draw=function(a){for(var b=this.children.length;b--;)this.children[b].draw(a)},Vectr.Scene=function(){this.children=[]},Vectr.Scene.prototype.draw=function(a){"string"==typeof this.clearColor?(a.save(),a.fillStyle=this.clearColor,a.fillRect(0,0,a.canvas.width,a.canvas.height),a.restore()):a.clearRect(0,0,a.canvas.width,a.canvas.height);for(var b=this.children.length;b--;)this.children[b].draw(a)},Vectr.Scene.prototype.update=function(a){for(var b=this.children.length;b--;)this.children[b].update(a)},Vectr.Scene.prototype.add=function(a){this.children.push(a)},Vectr.Scene.prototype.remove=function(a){var b=this.children.indexOf(a);-1!==b&&this.children.splice(b,1)},Vectr.Scene.prototype.destroy=function(){for(var a=this.children.length;a--;)"function"==typeof this.children[a].destroy&&this.children[a].destroy()},Vectr.Shape=function(a,b,c,d,e,f){var g;this.shape=c||"square",this.size=d||10,this.lineWidth=1,this.lineJoin="round",this.scale=1,this.speed=1,this.rotation=0,this.position={x:a,y:b},this.velocity={x:0,y:0},this.active=!0,this.solid=!1,this.color={red:255,green:255,blue:255,alpha:1},"string"==typeof e&&(g=e.match(/^rgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/))&&(this.color.red=parseInt(g[1],10),this.color.green=parseInt(g[2],10),this.color.blue=parseInt(g[3],10),this.color.alpha=parseFloat(g[4],10)),this.shadow={x:0,y:0,blur:0,color:{red:255,green:255,blue:255,alpha:1}},"string"==typeof f&&(g=f.match(/^(\d+(?:px)?)\s(\d+(?:px)?)\s(\d+(?:px)?)\srgba\((\d+),\s?(\d+),\s?(\d+),\s?(\d?\.?\d*)\)$/))&&(this.shadow.x=parseInt(g[1],10),this.shadow.y=parseInt(g[2],10),this.shadow.blur=parseInt(g[3],10),this.shadow.color.red=parseInt(g[4],10),this.shadow.color.green=parseInt(g[5],10),this.shadow.color.blue=parseInt(g[6],10),this.shadow.color.alpha=parseFloat(g[7],10))},Vectr.Shape.prototype.draw=function(a){if(this.active!==!1){if(a.save(),a.translate(this.position.x,this.position.y),1!==this.scale&&a.scale(this.scale,this.scale),0!==this.rotation&&this.rotation!==2*Math.PI&&a.rotate(this.rotation),(this.shadow.x>0||this.shadow.y>0||this.shadow.blur>0)&&(a.shadowOffsetX=this.shadow.x,a.shadowOffsetY=this.shadow.y,a.shadowBlur=this.shadow.blur,a.shadowColor="rgba("+this.shadow.color.red+", "+this.shadow.color.green+", "+this.shadow.color.blue+", "+this.shadow.color.alpha+")"),a.lineWidth=this.lineWidth,a.lineJoin=this.lineJoin,"function"==typeof this.customPath)this.customPath(a);else{switch(a.beginPath(),this.shape){case"triangle":a.moveTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0)),a.lineTo(this.size/2*Math.cos(120*Math.PI/180),this.size/2*Math.sin(120*Math.PI/180)),a.lineTo(this.size/2*Math.cos(240*Math.PI/180),this.size/2*Math.sin(240*Math.PI/180)),a.lineTo(this.size/2*Math.cos(0),this.size/2*Math.sin(0));break;case"circle":a.arc(0,0,this.size/2,360,!1);break;case"square":a.moveTo(this.size/2,this.size/2),a.lineTo(this.size/2,-this.size/2),a.lineTo(-this.size/2,-this.size/2),a.lineTo(-this.size/2,this.size/2),a.lineTo(this.size/2,this.size/2)}a.closePath(),this.solid===!0?(a.fillStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")",a.fill()):(a.strokeStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")",a.stroke())}a.restore()}},Vectr.Shape.prototype.update=function(a){this.active!==!1&&(this.position.x+=this.velocity.x*this.speed*a,this.position.y+=this.velocity.y*this.speed*a)},Vectr.Shape.prototype.collidesWith=function(a){return"square"===this.shape?Math.abs(this.position.x-a.position.x)<this.size/2+a.size/2&&Math.abs(this.position.y-a.position.y)<this.size/2+a.size/2:Math.sqrt(Math.pow(a.position.x-this.position.x,2)+Math.pow(a.position.y-this.position.y,2))<this.size/2+a.size/2};